<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Asia Project: A Star Re:Born</title>
    <link href="https://fonts.googleapis.com/css2?family=Spectral:wght@300;400;600;700&family=Dancing+Script:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #1a1a1a;
            --burgundy-primary: #800020;
            --burgundy-light: #a0002a;
            --burgundy-dark: #600018;
            --burgundy-muted: #4a0015;
            --white: #ffffff;
            --white-muted: #f5f5f5;
            --gray-light: #cccccc;
            --gray-medium: #888888;
            --success-green: #28a745;
            --border-color: #333333;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Mobile-first responsive design */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 15px;
            }

            .tabs {
                flex-wrap: wrap;
                gap: 5px;
            }

            .tab-button {
                padding: 8px 15px;
                font-size: 0.9rem;
                min-width: 80px;
                text-align: center;
            }

            .content {
                padding: 20px 15px;
            }

            .page-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .page-title {
                font-size: 1.5rem;
                text-align: center;
            }

            .add-btn {
                width: 100%;
                padding: 16px 20px;
                font-size: 1.1rem;
            }

            .song-card {
                padding: 15px;
            }

            .song-header {
                flex-direction: column;
                gap: 10px;
            }

            .song-actions {
                justify-content: center;
                flex-wrap: wrap;
            }

            .modal-content {
                width: 95%;
                margin: 2% auto;
                padding: 20px;
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            .form-actions {
                flex-direction: column;
                gap: 10px;
            }

            .btn-cancel,
            .btn-save {
                width: 100%;
                padding: 16px;
                font-size: 1.1rem;
            }
        }

        /* Touch-friendly buttons */
        @media (max-width: 768px) {
            .btn-small {
                padding: 12px 16px;
                font-size: 1rem;
                min-height: 44px;
            }

            .play-btn {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
        }
        
        body {
            font-family: 'Avenir', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .header {
            background: #2a2a2a;
            border-bottom: 2px solid var(--burgundy-primary);
            padding: 20px 40px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header h1 {
            font-family: 'Avenir', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--white);
            text-align: center;
            margin-bottom: 20px;
        }

        .tabs {
            display: flex;
            justify-content: center;
            gap: 0;
        }

        .tab-button {
            background: var(--bg-primary);
            color: var(--gray-light);
            border: 2px solid var(--border-color);
            padding: 12px 30px;
            cursor: pointer;
            font-family: 'Spectral', serif;
            font-size: 1.1rem;
            font-weight: 400;
            transition: all 0.3s ease;
            border-right: none;
        }

        .tab-button:first-child {
            border-radius: 0;
        }

        .tab-button:last-child {
            border-radius: 0;
            border-right: 2px solid var(--border-color);
        }

        .tab-button.active {
            background: var(--burgundy-primary);
            color: var(--white);
            border-color: var(--burgundy-primary);
        }

        .tab-button:hover:not(.active) {
            background: var(--burgundy-muted);
            color: var(--white-muted);
        }

        .content {
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            color: var(--white);
        }

        .add-btn {
            background: var(--burgundy-primary);
            color: var(--white);
            border: none;
            padding: 14px 28px;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Spectral', serif;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            background: var(--burgundy-light);
            transform: translateY(-2px);
        }

        /* Songs Page */
        .song-card {
            background: #2a2a2a;
            border: 2px solid var(--border-color);
            border-left: 4px solid var(--burgundy-primary);
            border-radius: 0;
            padding: 24px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .song-card:hover {
            border-color: var(--burgundy-primary);
            transform: translateY(-2px);
        }

        .song-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .song-number {
            font-size: 0.9rem;
            color: var(--burgundy-primary);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .song-title {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--white);
            margin-bottom: 5px;
        }

        .song-vibe {
            font-size: 0.9rem;
            color: var(--gray-medium);
            font-style: italic;
        }

        .song-date {
            font-size: 0.85rem;
            color: var(--gray-medium);
        }

        .song-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn-small {
            background: var(--burgundy-muted);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .btn-small:hover {
            background: var(--burgundy-primary);
        }

        .play-btn {
            background: var(--success-green);
            color: var(--white);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.4rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .play-btn:hover {
            background: #20a035;
        }

        .song-info {
            flex: 1;
        }

        .song-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Phrases Page */
        .phrase-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .category-card {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 0;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .category-card.upbeat { border-left: 4px solid #ff6b6b; }
        .category-card.slow { border-left: 4px solid #4ecdc4; }
        .category-card.jazzy { border-left: 4px solid #45b7d1; }
        .category-card.rock { border-left: 4px solid #f39c12; }
        .category-card.funny { border-left: 4px solid #f1c40f; }
        .category-card.sexy { border-left: 4px solid #e74c3c; }
        .category-card.serious { border-left: 4px solid #34495e; }
        .category-card.longing { border-left: 4px solid #9b59b6; }
        .category-card.simple { border-left: 4px solid #95a5a6; }
        .category-card.emotional { border-left: 4px solid #e67e22; }

        .category-card:hover {
            transform: translateY(-4px);
            border-color: var(--burgundy-primary);
        }

        .category-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 10px;
        }

        .category-count {
            font-size: 0.9rem;
            color: var(--gray-medium);
        }

        /* Bulk Page */
        .bulk-upload {
            background: var(--bg-secondary);
            border: 2px dashed var(--burgundy-primary);
            border-radius: 0;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
        }

        .bulk-files {
            display: grid;
            gap: 15px;
        }

        .file-group {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 0;
            padding: 15px;
        }

        .group-date {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--burgundy-primary);
            margin-bottom: 10px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .file-name {
            color: var(--white);
            font-size: 0.9rem;
        }

        .file-actions {
            display: flex;
            gap: 8px;
        }

        .btn-upgrade {
            background: var(--success-green);
            color: var(--white);
            border: none;
            padding: 4px 12px;
            border-radius: 0;
            cursor: pointer;
            font-size: 0.8rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
        }

        .modal-content {
            background: var(--bg-secondary);
            margin: 5% auto;
            padding: 30px;
            width: 80%;
            max-width: 800px;
            border-radius: 0;
            border: 2px solid var(--burgundy-primary);
        }

        .close {
            color: var(--gray-light);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--white);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--white);
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 0;
            color: var(--white);
            font-family: 'Spectral', serif;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--burgundy-primary);
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn-cancel {
            background: var(--gray-medium);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Spectral', serif;
        }

        .btn-save {
            background: var(--burgundy-primary);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 0;
            cursor: pointer;
            font-family: 'Spectral', serif;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <span style="font-size: 1.8rem; margin-right: 15px; color: var(--burgundy-primary);">‚ù¶</span>
            "The Asia Project: A Star Re:Born"
            <span style="font-size: 1.8rem; margin-left: 15px; color: var(--burgundy-primary);">‚ù¶</span>
        </h1>
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('inbox')">üì• Inbox</button>
            <button class="tab-button" onclick="showTab('settings')">‚öôÔ∏è Setup</button>
        </div>
    </div>

    <div class="content">
        <!-- Inbox Tab -->
        <div id="inbox" class="tab-content active">
            <div class="page-header">
                <h2 class="page-title">Team Inbox</h2>
                <div style="color: var(--gray-medium); font-size: 0.9rem; text-align: center;">
                    All voice messages and texts organized by sender and date
                </div>
            </div>

            <!-- Phone Number Display -->
            <div style="background: var(--burgundy-muted); padding: 15px; margin-bottom: 20px; text-align: center; border-radius: 8px;">
                <div style="color: var(--white); font-size: 1.1rem; margin-bottom: 5px;">üì± Send messages to:</div>
                <div id="twilioNumber" style="color: var(--white); font-size: 1.3rem; font-weight: bold;">[Set up your Twilio number in Settings]</div>
                <div style="color: var(--gray-light); font-size: 0.9rem; margin-top: 5px;">üìû Call to record voice ‚Ä¢ üí¨ Text to save lyrics</div>
            </div>

            <!-- Refresh Button -->
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="add-btn" onclick="loadInbox()" style="padding: 12px 30px;">üîÑ Refresh Inbox</button>
            </div>

            <!-- Inbox Content -->
            <div id="inboxContent">
                <div style="text-align: center; color: var(--gray-medium); padding: 40px;">
                    üì• No messages yet. Send a text or call your Twilio number to get started!
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="page-header">
                <h2 class="page-title">Setup</h2>
                <div style="color: var(--gray-medium); font-size: 0.9rem; text-align: center;">
                    Configure your Twilio phone number and team contacts
                </div>
            </div>

            <!-- Twilio Configuration -->
            <div style="background: var(--bg-secondary); padding: 20px; margin-bottom: 20px; border: 2px solid var(--border-color);">
                <h3 style="color: var(--white); margin-bottom: 15px;">üìû Twilio Configuration</h3>

                <div style="margin-bottom: 15px;">
                    <label style="color: var(--white); display: block; margin-bottom: 5px;">Your Twilio Phone Number</label>
                    <input id="twilioNumberInput" type="text" placeholder="+1234567890" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                </div>

                <button class="add-btn" onclick="saveTwilioNumber()" style="width: 100%; padding: 12px;">üíæ Save Number</button>
            </div>

            <!-- Team Contact Mapping -->
            <div style="background: var(--bg-secondary); padding: 20px; margin-bottom: 20px; border: 2px solid var(--border-color);">
                <h3 style="color: var(--white); margin-bottom: 15px;">üë• Team Contacts</h3>
                <div style="color: var(--gray-medium); margin-bottom: 15px;">Map phone numbers to team member names for better organization</div>

                <div id="teamContacts">
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 10px; margin-bottom: 10px;">
                        <input type="text" placeholder="Name (e.g., Asia)" style="padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                        <input type="text" placeholder="Phone (e.g., +1234567890)" style="padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                        <button class="btn-small" onclick="addTeamContact(this)" style="padding: 10px 15px;">‚ûï</button>
                    </div>
                </div>

                <button class="add-btn" onclick="saveTeamContacts()" style="width: 100%; padding: 12px; margin-top: 15px;">üíæ Save Contacts</button>
            </div>

            <!-- AWS S3 Configuration -->
            <div style="background: var(--bg-secondary); padding: 20px; border: 2px solid var(--border-color);">
                <h3 style="color: var(--white); margin-bottom: 15px;">‚òÅÔ∏è S3 Storage</h3>
                <div style="color: var(--gray-medium); margin-bottom: 15px;">All voice recordings are automatically stored in your S3 bucket</div>

                <div style="margin-bottom: 15px;">
                    <label style="color: var(--white); display: block; margin-bottom: 5px;">S3 Bucket Name</label>
                    <input id="s3BucketInput" type="text" placeholder="your-bucket-name" value="ladyembersongs-recordings" style="width: 100%; padding: 12px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                </div>

                <div style="background: var(--bg-primary); padding: 15px; border: 1px solid var(--border-color); margin-top: 15px;">
                    <div style="color: var(--white); font-size: 0.9rem; margin-bottom: 8px;">üìã Environment Variables Needed:</div>
                    <div style="color: var(--gray-light); font-size: 0.8rem; font-family: monospace; line-height: 1.4;">
                        AWS_ACCESS_KEY_ID=your_key<br>
                        AWS_SECRET_ACCESS_KEY=your_secret<br>
                        TWILIO_ACCOUNT_SID=your_sid<br>
                        TWILIO_AUTH_TOKEN=your_token<br>
                        TWILIO_PHONE_NUMBER=your_number
                    </div>
                </div>
            </div>
        </div>

        <!-- Songs Tab -->
        <div id="songs" class="tab-content active">
            <div class="page-header">
                <h2 class="page-title">Songs</h2>
                <button class="add-btn" onclick="openNewSongEditor()">+ New Song</button>
            </div>
            <div id="songs-list">
                <!-- Songs will be loaded here -->
            </div>
        </div>

        <!-- Phrases Tab -->
        <div id="phrases" class="tab-content">
            <div class="page-header">
                <h2 class="page-title">Phrases</h2>
                <button class="add-btn" onclick="openPhraseModal()">+ New Phrase</button>
                <button class="add-btn" onclick="openDeleteCategoryModal()" style="background: #dc3545; margin-left: 10px;">Delete Category</button>
            </div>
            
            <div style="margin-bottom: 20px; text-align: center;">
                <button class="add-btn" onclick="addNewCategory()" style="margin-bottom: 20px;">+ New Category</button>
            </div>
            
            <div class="phrase-categories" id="phrase-categories">
                <div style="text-align: center; color: var(--gray-medium); padding: 40px;">
                    No phrase categories yet. Click "+ New Category" to create your first category!
                </div>
            </div>
            
            <div id="phrases-list">
                <!-- Phrases will be loaded here -->
            </div>
        </div>

        <!-- Bulk Tab -->
        <div id="bulk" class="tab-content">
            <div class="page-header">
                <h2 class="page-title">Bulk Upload</h2>
            </div>
            
            <div class="bulk-upload">
                <h3>Upload Audio Files</h3>
                <p>Drag and drop audio files here or click to browse</p>
                <input type="file" id="bulk-files" multiple accept="audio/*" style="margin-top: 20px;">
                <button class="add-btn" onclick="uploadBulkFiles()" style="margin-top: 15px;">Upload Files</button>
            </div>
            
            <div id="bulk-files-list">
                <!-- Bulk files will be displayed here grouped by date -->
            </div>
        </div>

        <!-- Mood Board Tab -->
        <div id="moodboard" class="tab-content">
            <div class="page-header">
                <h2 class="page-title">Mood Board</h2>
            </div>
            
            <div style="background: var(--bg-secondary); padding: 20px; border: 2px solid var(--border-color);">
                <h3 style="color: var(--white); margin-bottom: 15px;">Mood Board</h3>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="add-btn" onclick="showUploadModal()">+ Add</button>
                </div>
                
                <div id="moodboard-container" style="display: grid; gap: 15px;">
                    <div style="text-align: center; color: var(--gray-medium); padding: 40px;">
                        No mood board items yet. Click "+ Add" to add your first inspiration!
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Song Modal -->
    <div id="songModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeSongModal()">&times;</span>
            <h2>Add New Song</h2>
            <form id="songForm">
                <div class="form-group">
                    <label for="songTitle">Title</label>
                    <input type="text" id="songTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="songVibe">Vibe</label>
                    <select id="songVibe" name="vibe">
                        <option value="">Select vibe...</option>
                        <option value="upbeat">Upbeat</option>
                        <option value="slow">Slow</option>
                        <option value="jazzy">Jazzy</option>
                        <option value="rock">Rock</option>
                        <option value="funny">Funny</option>
                        <option value="sexy">Sexy</option>
                        <option value="serious">Serious</option>
                        <option value="longing">Longing</option>
                        <option value="simple">Simple</option>
                        <option value="emotional">Emotional</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="songLyrics">Lyrics</label>
                    <textarea id="songLyrics" name="lyrics" rows="8"></textarea>
                </div>
                <div class="form-group">
                    <label for="songNotes">Notes</label>
                    <textarea id="songNotes" name="notes" rows="4"></textarea>
                </div>
                <div class="form-group">
                    <label for="songAudio">Audio File</label>
                    <input type="file" id="songAudio" name="audio" accept="audio/*">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closeSongModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Song</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Phrase Modal -->
    <div id="phraseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePhraseModal()">&times;</span>
            <h2>Add New Phrase</h2>
            <form id="phraseForm">
                <div class="form-group">
                    <label for="phraseTitle">Title</label>
                    <input type="text" id="phraseTitle" name="title" required>
                </div>
                <div class="form-group">
                    <label for="phraseCategory">Category</label>
                    <select id="phraseCategory" name="category" required>
                        <option value="">Select category...</option>
                        <option value="upbeat">Upbeat</option>
                        <option value="slow">Slow</option>
                        <option value="jazzy">Jazzy</option>
                        <option value="rock">Rock</option>
                        <option value="funny">Funny</option>
                        <option value="sexy">Sexy</option>
                        <option value="serious">Serious</option>
                        <option value="longing">Longing</option>
                        <option value="simple">Simple</option>
                        <option value="emotional">Emotional</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="phraseNotes">Notes</label>
                    <textarea id="phraseNotes" name="notes" rows="4" placeholder="What inspired this phrase?"></textarea>
                </div>
                <div class="form-group">
                    <label for="phraseAudio">Audio File</label>
                    <input type="file" id="phraseAudio" name="audio" accept="audio/*" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel" onclick="closePhraseModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Phrase</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Tab functionality
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load content based on tab
            if (tabName === 'songs') {
                loadSongs();
            } else if (tabName === 'phrases') {
                loadPhrases();
            } else if (tabName === 'bulk') {
                loadBulkFiles();
            } else if (tabName === 'moodboard') {
                loadMoodBoard();
            }
        }

        // Modal functions
        function openSongModal() {
            document.getElementById('songModal').style.display = 'block';
        }

        function closeSongModal() {
            document.getElementById('songModal').style.display = 'none';
        }

        // Global data storage
        let songsData = [];
        let bulkFilesData = [];

        // Load functions
        function loadSongs() {
            const songsList = document.getElementById('songs-list');
            songsList.innerHTML = '<div style="text-align: center; color: var(--gray-medium); padding: 40px;">No songs yet. Click "+ New Song" to get started!</div>';
            
            // Fetch real songs from backend
            fetch('/api/songs')
                .then(response => response.json())
                .then(data => {
                    songsData = data.songs || [];
                    if (songsData.length > 0) {
                        songsList.innerHTML = '';
                        songsData.forEach((song, index) => {
                            const songCard = createSongCard(song, index + 1);
                            songsList.appendChild(songCard);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error loading songs:', error);
                });
        }

        function createSongCard(song, number) {
            const card = document.createElement('div');
            card.className = 'song-card';
            
            const dateObj = new Date(song.created_at);
            const date = dateObj.toLocaleDateString();
            const time = dateObj.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const audioCount = song.audio_files ? song.audio_files.split(',').length : 0;
            const authorColor = song.author === 'asia' ? '#ff69b4' : '#4169e1'; // pink for asia, blue for sebastian
            
            card.innerHTML = `
                <div class="song-info" onclick="editSong(${song.id})" style="cursor: pointer;">
                    <div class="song-header">
                        <div>
                            <div class="song-title">${number}. "${song.title || 'Untitled'}"</div>
                            <div style="color: var(--gray-medium); font-size: 0.85rem; margin-top: 4px; font-weight: normal;">üîÑ ${dateObj.toLocaleDateString('en-US')} ${time} (${song.author || 'Unknown'})</div>
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 10px; justify-content: flex-end;">
                            <button class="play-btn" onclick="event.stopPropagation(); playSong(${song.id})" title="Play all clips">‚ñ∂</button>
                            <button class="btn-small" onclick="event.stopPropagation(); editSong(${song.id})" style="background: transparent; border: 2px solid var(--white); padding: 6px 12px; font-size: 0.9rem;">‚úèÔ∏è Edit</button>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        function loadPhrases() {
            // Load phrases from backend when implemented
            console.log('Phrases loaded');
        }

        function loadBulkFiles() {
            const bulkList = document.getElementById('bulk-files-list');
            bulkList.innerHTML = '<div style="text-align: center; color: var(--gray-medium); padding: 40px;">No bulk files uploaded yet. Use the upload section above to add audio files!</div>';
            
            // Here you would fetch bulk files from backend when implemented
            // For now, keep it empty and ready for real uploads
        }

        // New functions
        function playSong(id) {
            alert(`Playing song ${id} - all audio clips in sequence`);
        }

        function editSong(id) {
            const song = songsData.find(s => s.id == id);
            if (song) {
                showEditPage(song);
            } else {
                alert('Song not found');
            }
        }
        
        function showEditPage(song) {
            // Hide all main tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Show edit page
            const content = document.querySelector('.content');
            const editPageHTML = `
                <div id="edit-page" class="tab-content active" style="display: block;">
                    <div class="page-header" style="background: var(--success-green); padding: 20px; margin: -40px -40px 30px -40px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h2 style="color: var(--white); margin: 0;">${song.id ? `Edit: "${song.title}"` : 'New Song'}</h2>
                            <button class="btn-small" onclick="closeEditPage()" style="background: var(--gray-medium);">‚Üê Back</button>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px; height: 70vh;">
                        <!-- Audio Visualizer Section (2/3) -->
                        <div style="background: var(--bg-secondary); padding: 20px; border: 2px solid var(--border-color);">
                            <h3 style="color: var(--white); margin-bottom: 20px;">Audio Visualizer</h3>
                            
                            <!-- Audio Visualizer Controls -->
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div style="display: flex; gap: 10px; align-items: center;">
                                    <button class="play-btn" onclick="playAllTracks()" title="Play all tracks in sequence" style="width: 60px; height: 60px; font-size: 1.6rem;">‚ñ∂</button>
                                    <button class="play-btn" onclick="pauseAll()" title="Pause" style="width: 50px; height: 50px; font-size: 1.2rem; background: var(--gray-medium);">‚è∏</button>
                                    <button class="play-btn" onclick="stopAll()" title="Stop" style="width: 50px; height: 50px; font-size: 1.2rem; background: var(--burgundy-dark);">‚èπ</button>
                                    <button class="btn-small" onclick="seekBackward()" title="Seek backward" style="margin-left: 10px;">‚è™</button>
                                    <button class="btn-small" onclick="seekForward()" title="Seek forward">‚è©</button>
                                    <select onchange="addMarker(this.value); this.selectedIndex = 0;" style="background: var(--burgundy-muted); color: var(--white); border: 1px solid var(--burgundy-primary); padding: 8px; margin-left: 15px;">
                                        <option value="">+ Add Marker</option>
                                        <option value="intro">Intro</option>
                                        <option value="verse">Verse</option>
                                        <option value="chorus">Chorus</option>
                                        <option value="bridge">Bridge</option>
                                        <option value="hook">Hook</option>
                                        <option value="outro">Outro</option>
                                        <option value="instrumental">Instrumental</option>
                                    </select>
                                </div>
                                <div style="color: var(--gray-light); font-size: 0.9rem;">0:00 / 3:24</div>
                            </div>
                            
                            <!-- Waveform Visualizer -->
                            <div style="background: #f5f5f5; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border-color); height: 160px; position: relative;">
                                <!-- Y-axis -->
                                <div style="position: absolute; left: 5px; top: 20px; bottom: 20px; width: 30px; display: flex; flex-direction: column; justify-content: space-between; font-size: 10px; color: #666;">
                                    <span>+1</span>
                                    <span>0</span>
                                    <span>-1</span>
                                </div>
                                <!-- X-axis center line -->
                                <div style="position: absolute; top: 50%; left: 40px; right: 20px; height: 1px; background: #999;"></div>
                                <!-- Y-axis line -->
                                <div style="position: absolute; left: 40px; top: 20px; bottom: 20px; width: 1px; background: #999;"></div>
                                <!-- Waveform area -->
                                <div style="position: absolute; left: 41px; right: 20px; top: 20px; bottom: 20px; display: flex; align-items: center; gap: 1px;">
                                    ${song.audio_files && song.audio_files.length > 0 ? song.audio_files.split(',').map((file, trackIndex) => {
                                        const trackWidth = 100 / song.audio_files.split(',').length;
                                        return Array.from({length: Math.floor(trackWidth * 3)}, (_, i) => {
                                            const intensity = Math.sin(i * 0.2) * 0.8; // -0.8 to +0.8
                                            const isPlayed = trackIndex < 1;
                                            const color = isPlayed ? 'var(--burgundy-primary)' : '#666';
                                            
                                            if (intensity >= 0) {
                                                // Positive waveform (top half)
                                                const height = intensity * 50; // 0 to 50% of container
                                                return `<div style="width: 2px; height: 50%; display: flex; flex-direction: column; justify-content: flex-end;">
                                                    <div style="background: ${color}; width: 2px; height: ${height}%;"></div>
                                                </div>`;
                                            } else {
                                                // Negative waveform (bottom half)
                                                const height = Math.abs(intensity) * 50; // 0 to 50% of container
                                                return `<div style="width: 2px; height: 50%; display: flex; flex-direction: column; justify-content: flex-start;">
                                                    <div style="background: ${color}; width: 2px; height: ${height}%;"></div>
                                                </div>`;
                                            }
                                        }).join('');
                                    }).join('') : ''}
                                </div>
                                <!-- Playhead -->
                                <div id="playhead" style="position: absolute; top: 20px; bottom: 20px; left: 25%; width: 2px; background: red; opacity: 0.8; cursor: ew-resize;" draggable="true" onmousedown="startDrag(event)" onclick="seekToPosition(event)"></div>
                                <!-- X-axis labels -->
                                <div style="position: absolute; bottom: 5px; left: 41px; right: 20px; display: flex; justify-content: space-between; font-size: 10px; color: #666;">
                                    <span>0:00</span>
                                    <span>1:30</span>
                                    <span>3:00</span>
                                </div>
                                <div id="markers-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                                    <!-- Markers will be added here -->
                                </div>
                            </div>
                            
                            <!-- Lyrics Section under visualizer -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: var(--white); margin-bottom: 15px;">Lyrics</h4>
                                <div style="background: var(--bg-primary); padding: 20px; border: 1px solid var(--border-color); min-height: 300px;">
                                    <textarea style="width: 100%; height: 280px; padding: 15px; background: transparent; border: none; color: var(--white); resize: vertical; font-size: 1rem; line-height: 1.4;" placeholder="Write lyrics that sync with the timeline...">${song.lyrics || ''}</textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Audio Tracks & Controls Section (1/3) -->
                        <div style="background: var(--bg-secondary); padding: 20px; border: 2px solid var(--border-color);">
                            <div style="margin-bottom: 20px;">
                                <h3 style="color: var(--white); margin-bottom: 15px;">Song Details</h3>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="color: var(--white); display: block; margin-bottom: 5px;">Title</label>
                                    <input type="text" value="${song.title || ''}" placeholder="Enter song title..." style="width: 100%; padding: 8px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                                </div>
                                
                                <div style="margin-bottom: 15px;">
                                    <label style="color: var(--white); display: block; margin-bottom: 5px;">Author</label>
                                    <select style="width: 100%; padding: 8px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                                        <option value="asia" selected>Asia</option>
                                        <option value="sebastian">Sebastian</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Audio Tracks Section -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: var(--white); margin-bottom: 15px;">Audio Tracks</h4>
                                <div style="display: grid; gap: 8px; max-height: 250px; overflow-y: auto;">
                                    <div style="background: var(--burgundy-muted); padding: 8px; border: 1px solid var(--burgundy-primary); font-size: 0.8rem; text-align: center; color: var(--white);">
                                        ‚ö° Combine
                                    </div>
                                    ${song.audio_files ? song.audio_files.split(',').map((file, index) => `
                                        <div style="background: var(--bg-primary); padding: 10px; border: 1px solid var(--border-color); font-size: 0.85rem; border-left: 3px solid ${index === 0 ? 'var(--success-green)' : 'var(--burgundy-primary)'};">
                                            <div style="color: var(--white); margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                                                <span>${index + 1}. ${file}</span>
                                                <span style="font-size: 0.7rem; color: var(--gray-medium);">${index === 0 ? 'CURRENT' : 'QUEUED'}</span>
                                            </div>
                                            <div style="display: flex; gap: 4px; justify-content: center;">
                                                <button class="btn-small" onclick="moveTrackUp(${index})" title="Move up" style="font-size: 0.7rem; padding: 4px 8px;" ${index === 0 ? 'disabled' : ''}>‚Üë</button>
                                                <button class="btn-small" onclick="moveTrackDown(${index})" title="Move down" style="font-size: 0.7rem; padding: 4px 8px;" ${index === song.audio_files.split(',').length - 1 ? 'disabled' : ''}>‚Üì</button>
                                                <button class="btn-small" onclick="playTrack(${index})" title="Play this track" style="font-size: 0.7rem; padding: 4px 8px;">‚ñ∂</button>
                                                <button class="btn-small" onclick="deleteTrack(${index})" title="Delete" style="font-size: 0.7rem; padding: 4px 8px;">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                    `).join('') : '<p style="color: var(--gray-medium); text-align: center;">No audio files</p>'}
                                </div>
                            </div>
                            
                            <!-- Upload New Track Section -->
                            <div style="margin-bottom: 20px;">
                                <h4 style="color: var(--white); margin-bottom: 10px;">Upload New Track</h4>
                                <div style="background: var(--bg-primary); padding: 15px; border: 2px dashed var(--border-color); text-align: center;">
                                    <input type="file" id="newTrackFile" accept="audio/*" style="margin-bottom: 10px;">
                                    <button class="btn-small" onclick="uploadNewTrack()" style="background: var(--success-green); width: 100%;">+ Add Track</button>
                                </div>
                            </div>
                            
                        </div>
                    </div>
                    
                    </div>
                    
                    <!-- Production Notes Section (Bottom Banner) -->
                    <div style="background: var(--bg-secondary); padding: 20px; margin-top: 30px; border: 2px solid var(--border-color); clear: both;">
                        <h4 style="color: var(--white); margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px;">Production Notes</h4>
                        <textarea style="width: 100%; height: 100px; padding: 15px; background: var(--bg-primary); border: 2px solid var(--border-color); color: var(--white); resize: vertical; border-radius: 4px;" placeholder="Add production notes about this song...">${song.notes || ''}</textarea>
                    </div>
                    
                    <!-- Mood Board Section -->
                    <div style="background: var(--bg-secondary); padding: 15px; margin-top: 20px; border: 2px solid var(--border-color);">
                        <h4 style="color: var(--white); margin-bottom: 15px;">Mood Board</h4>
                        
                        <!-- Links Section -->
                        <div style="margin-bottom: 20px;">
                            <h5 style="color: var(--white); margin-bottom: 10px;">Inspiration Links</h5>
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <input type="url" placeholder="Add article or reference link..." style="flex: 1; padding: 8px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                                <button class="btn-small" onclick="addLink()" style="background: var(--burgundy-primary);">+ Add</button>
                            </div>
                            <div id="links-list" style="display: grid; gap: 8px;">
                                ${song.id && song.title ? `
` : ''}
                            </div>
                        </div>
                        
                        <!-- Image Gallery Section -->
                        <div>
                            <h5 style="color: var(--white); margin-bottom: 10px;">Visual Inspiration</h5>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <input type="file" accept="image/*" multiple style="flex: 1; padding: 8px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                                <button class="btn-small" onclick="uploadImages()" style="background: var(--burgundy-primary);">Upload</button>
                            </div>
                            <div id="image-gallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Save/Cancel Actions -->
                    <div style="position: absolute; top: 20px; right: 40px; z-index: 1001;">
                        <button class="btn-save" onclick="saveSong(${song.id})" style="display: flex; align-items: center; gap: 8px; background: var(--burgundy-primary); color: var(--white); border: none; padding: 12px 20px; font-family: 'Spectral', serif;">üíæ Save</button>
                    </div>
                    
                    <!-- Delete Section (Bottom) -->
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); text-align: center;">
                        <button class="btn-small" onclick="deleteSong(${song.id})" style="background: #dc3545;">‚ùå Delete Song</button>
                    </div>
                </div>
            `;
            
            content.innerHTML += editPageHTML;
        }
        
        function closeEditPage() {
            const editPage = document.getElementById('edit-page');
            if (editPage) {
                editPage.remove();
            }
            
            // Show songs tab again
            document.getElementById('songs').style.display = 'block';
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.tab-button[onclick*="songs"]').classList.add('active');
        }
        
        function addMarker(type) {
            alert(`Adding ${type} marker at current playback position`);
        }
        
        function saveSong(id) {
            // Collect all form data from the edit page
            const title = document.querySelector('input[value*="title"]')?.value || document.querySelector('input[placeholder*="title"]')?.value || '';
            const author = document.querySelector('select option:checked')?.value || 'Asia';
            const lyrics = document.querySelector('textarea[placeholder*="lyrics"]')?.value || '';
            const notes = document.querySelector('textarea[placeholder*="production notes"]')?.value || '';
            
            const songData = {
                id: id,
                title: title,
                author: author,
                lyrics: lyrics,
                notes: notes,
                audio_files: [], // Will be populated from actual uploads
                voice_notes: [],
                source: 'manual_entry'
            };
            
            fetch('/api/save_song', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(songData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Song saved successfully!');
                    closeEditPage();
                    loadSongs(); // Refresh the songs list
                } else {
                    alert('Save failed: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Save error:', error);
                alert('Save failed. Please try again.');
            });
        }
        
        function deleteSong(id) {
            if (confirm('Are you sure you want to delete this song? This action cannot be undone.')) {
                fetch(`/api/delete_song/${id}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Song deleted successfully!');
                        closeEditPage();
                        loadSongs(); // Refresh the songs list
                    } else {
                        alert('Delete failed: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Delete error:', error);
                    alert('Delete failed. Please try again.');
                });
            }
        }
        
        // Audio visualizer functions
        function playAllTracks() {
            alert('Playing all tracks in sequence - auto-joining audio files');
        }
        
        function pauseAll() {
            alert('Pausing all audio');
        }
        
        function stopAll() {
            alert('Stopping all audio');
        }
        
        function playTrack(index) {
            alert(`Playing track ${index + 1}`);
        }
        
        function deleteTrack(index) {
            if (confirm(`Delete track ${index + 1}?`)) {
                alert(`Track ${index + 1} deleted`);
            }
        }
        
        function moveTrackUp(index) {
            if (index > 0) {
                alert(`Moving track ${index + 1} up`);
                // Here you would reorder the tracks
            }
        }
        
        function moveTrackDown(index) {
            alert(`Moving track ${index + 1} down`);
            // Here you would reorder the tracks
        }
        
        function uploadNewTrack() {
            const fileInput = document.getElementById('newTrackFile');
            if (fileInput.files.length > 0) {
                const fileName = fileInput.files[0].name;
                alert(`Uploading new track: ${fileName}`);
                // Here you would upload the file and add it to the tracks list
            } else {
                alert('Please select an audio file to upload');
            }
        }
        
        function seekBackward() {
            alert('Seeking backward 10 seconds');
        }
        
        function seekForward() {
            alert('Seeking forward 10 seconds');
        }
        
        function addMarker(markerType) {
            if (markerType) {
                // Add a pin marker to the visualizer at current position
                const markersContainer = document.getElementById('markers-container');
                if (markersContainer) {
                    const pin = document.createElement('div');
                    // Get current playhead position
                    const playhead = document.getElementById('playhead');
                    const currentPosition = playhead ? parseFloat(playhead.style.left) / markersContainer.offsetWidth * 100 : 25;
                    pin.style.cssText = `
                        position: absolute;
                        left: ${currentPosition}%;
                        top: 0;
                        width: 1px;
                        height: 100%;
                        background: orange;
                        pointer-events: auto;
                        cursor: pointer;
                    `;
                    pin.title = `${markerType.charAt(0).toUpperCase() + markerType.slice(1)} marker`;
                    
                    // Add a small label above the pin
                    const label = document.createElement('div');
                    label.style.cssText = `
                        position: absolute;
                        top: -20px;
                        left: -10px;
                        background: orange;
                        color: white;
                        padding: 2px 6px;
                        font-size: 10px;
                        border-radius: 3px;
                        white-space: nowrap;
                    `;
                    label.textContent = markerType;
                    pin.appendChild(label);
                    
                    markersContainer.appendChild(pin);
                }
                alert(`Added ${markerType} marker at current position`);
            }
        }
        
        function openNewSongEditor() {
            const newSong = {
                id: null,
                title: '',
                author: 'Asia',
                audio_files: ''
            };
            showEditPage(newSong);
        }
        
        function openPhraseModal() {
            document.getElementById('phraseModal').style.display = 'block';
        }
        
        function closePhraseModal() {
            document.getElementById('phraseModal').style.display = 'none';
        }
        
        function openDeleteCategoryModal() {
            const categories = ['upbeat', 'slow', 'jazzy', 'rock', 'funny', 'sexy', 'serious', 'longing', 'simple', 'emotional'];
            const categoryOptions = categories.map(cat => `<option value="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`).join('');
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.8); z-index: 2000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); padding: 30px; border: 2px solid var(--burgundy-primary); max-width: 400px; width: 90%;">
                    <h3 style="color: var(--white); margin-bottom: 20px;">Delete Category</h3>
                    <p style="color: var(--white); margin-bottom: 20px;">Select a category to delete:</p>
                    <select id="deleteCategory" style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white); margin-bottom: 20px;">
                        <option value="">Choose category...</option>
                        ${categoryOptions}
                    </select>
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button onclick="this.closest('div[style*=\"fixed\"]').remove()" style="background: var(--gray-medium); color: var(--white); border: none; padding: 10px 20px; cursor: pointer;">Cancel</button>
                        <button onclick="confirmDeleteCategory()" style="background: #dc3545; color: var(--white); border: none; padding: 10px 20px; cursor: pointer;">Delete</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function confirmDeleteCategory() {
            const select = document.getElementById('deleteCategory');
            const category = select.value;
            if (category) {
                if (confirm(`Are you sure you want to delete the "${category}" category and all its phrases?`)) {
                    alert(`Deleting category: ${category}`);
                    document.querySelector('div[style*="fixed"]').remove();
                }
            } else {
                alert('Please select a category to delete');
            }
        }
        
        // Playhead dragging functions
        let isDragging = false;
        let visualizerContainer = null;
        
        function startDrag(event) {
            isDragging = true;
            visualizerContainer = event.target.closest('div[style*="height: 160px"]');
            event.preventDefault();
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }
        
        function drag(event) {
            if (!isDragging || !visualizerContainer) return;
            
            const rect = visualizerContainer.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = Math.max(0, Math.min(100, ((x - 41) / (rect.width - 61)) * 100));
            
            const playhead = document.getElementById('playhead');
            if (playhead) {
                playhead.style.left = `${41 + (percentage / 100) * (visualizerContainer.offsetWidth - 61)}px`;
            }
        }
        
        function stopDrag() {
            isDragging = false;
            visualizerContainer = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
        }
        
        function seekToPosition(event) {
            if (isDragging) return;
            
            const container = event.target.closest('div[style*="height: 160px"]');
            const rect = container.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = Math.max(0, Math.min(100, ((x - 41) / (rect.width - 61)) * 100));
            
            const playhead = document.getElementById('playhead');
            if (playhead) {
                playhead.style.left = `${41 + (percentage / 100) * (container.offsetWidth - 61)}px`;
            }
            
            const timeInSeconds = (percentage / 100) * 180; // Assuming 3 minute song
            const minutes = Math.floor(timeInSeconds / 60);
            const seconds = Math.floor(timeInSeconds % 60);
            alert(`Seeking to ${minutes}:${seconds.toString().padStart(2, '0')}`);
        }
        
        // Mood board functions
        function addLink() {
            const input = document.querySelector('input[type="url"]');
            const url = input.value.trim();
            if (url) {
                const linksList = document.getElementById('links-list');
                const linkElement = document.createElement('div');
                linkElement.style.cssText = 'background: var(--bg-primary); padding: 8px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;';
                linkElement.innerHTML = `
                    <a href="${url}" target="_blank" style="color: var(--burgundy-light); text-decoration: none;">üîó ${url}</a>
                    <button class="btn-small" onclick="this.closest('div').remove()" style="font-size: 0.7rem; padding: 2px 6px;">‚ùå</button>
                `;
                linksList.appendChild(linkElement);
                input.value = '';
            }
        }
        
        function uploadImages() {
            const input = document.querySelector('input[type="file"]');
            const files = input.files;
            if (files.length > 0) {
                const gallery = document.getElementById('image-gallery');
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageElement = document.createElement('div');
                        imageElement.style.cssText = 'position: relative; aspect-ratio: 1; background: var(--bg-primary); border: 1px solid var(--border-color); overflow: hidden;';
                        imageElement.innerHTML = `
                            <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
                            <button class="btn-small" onclick="removeImage(this)" style="position: absolute; top: 2px; right: 2px; font-size: 0.6rem; padding: 2px 4px;">‚ùå</button>
                        `;
                        gallery.appendChild(imageElement);
                    };
                    reader.readAsDataURL(file);
                });
                input.value = '';
            }
        }
        
        function removeImage(button) {
            button.closest('div').remove();
        }
        
        function loadMoodBoard() {
            console.log('Mood board loaded');
        }
        
        function addMoodboardLink() {
            const input = document.getElementById('moodboard-link-input');
            const url = input.value.trim();
            if (url) {
                const linksList = document.getElementById('moodboard-links-list');
                const linkElement = document.createElement('div');
                linkElement.style.cssText = 'background: var(--bg-primary); padding: 12px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;';
                linkElement.innerHTML = `
                    <a href="${url}" target="_blank" style="color: var(--burgundy-light); text-decoration: none;">üîó ${url}</a>
                    <button class="btn-small" onclick="this.closest('div').remove()" style="font-size: 0.8rem; padding: 4px 8px;">‚ùå</button>
                `;
                linksList.appendChild(linkElement);
                input.value = '';
            }
        }
        
        function uploadMoodboardImages() {
            const input = document.getElementById('moodboard-images');
            const files = input.files;
            if (files.length > 0) {
                const gallery = document.getElementById('moodboard-image-gallery');
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageElement = document.createElement('div');
                        imageElement.style.cssText = 'position: relative; aspect-ratio: 1; background: var(--bg-primary); border: 1px solid var(--border-color); overflow: hidden;';
                        imageElement.innerHTML = `
                            <img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover;">
                            <button class="btn-small" onclick="removeMoodboardImage(this)" style="position: absolute; top: 5px; right: 5px; font-size: 0.7rem; padding: 3px 6px;">‚ùå</button>
                        `;
                        gallery.appendChild(imageElement);
                    };
                    reader.readAsDataURL(file);
                });
                input.value = '';
            }
        }
        
        function removeMoodboardImage(button) {
            button.closest('div').remove();
        }
        
        // Enhanced mood board functions
        function showUploadModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.8); z-index: 2000; display: flex;
                align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div style="background: var(--bg-secondary); padding: 30px; border: 2px solid var(--burgundy-primary); max-width: 500px; width: 90%;">
                    <h3 style="color: var(--white); margin-bottom: 20px;">Add to Mood Board</h3>
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <button onclick="showLinkForm()" style="flex: 1; padding: 15px; background: var(--burgundy-primary); color: var(--white); border: none; cursor: pointer;">üîó Add Link</button>
                        <button onclick="showImageForm()" style="flex: 1; padding: 15px; background: var(--burgundy-primary); color: var(--white); border: none; cursor: pointer;">üñºÔ∏è Add Image</button>
                    </div>
                    <div id="upload-form-container"></div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button onclick="this.closest('div[style*=\"fixed\"]').remove()" style="background: var(--gray-medium); color: var(--white); border: none; padding: 10px 20px; cursor: pointer;">Cancel</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function showLinkForm() {
            const container = document.getElementById('upload-form-container');
            container.innerHTML = `
                <div style="border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--white); display: block; margin-bottom: 5px;">Title</label>
                        <input type="text" id="link-title" placeholder="e.g., Artist - Song Title" style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--white); display: block; margin-bottom: 5px;">URL</label>
                        <input type="url" id="link-url" placeholder="https://..." style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--white); display: block; margin-bottom: 5px;">Notes</label>
                        <textarea id="link-notes" placeholder="Why is this inspiring?" style="width: 100%; height: 60px; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white); resize: vertical;"></textarea>
                    </div>
                    <button onclick="addMoodboardLinkItem()" style="background: var(--success-green); color: var(--white); border: none; padding: 10px 20px; cursor: pointer; width: 100%;">Add Link</button>
                </div>
            `;
        }
        
        function showImageForm() {
            const container = document.getElementById('upload-form-container');
            container.innerHTML = `
                <div style="border-top: 1px solid var(--border-color); padding-top: 20px;">
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--white); display: block; margin-bottom: 5px;">Title</label>
                        <input type="text" id="image-title" placeholder="e.g., Color Palette" style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--white); display: block; margin-bottom: 5px;">Image</label>
                        <input type="file" id="image-file" accept="image/*" style="width: 100%; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white);">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="color: var(--white); display: block; margin-bottom: 5px;">Notes</label>
                        <textarea id="image-notes" placeholder="What does this represent?" style="width: 100%; height: 60px; padding: 10px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white); resize: vertical;"></textarea>
                    </div>
                    <button onclick="addMoodboardImageItem()" style="background: var(--success-green); color: var(--white); border: none; padding: 10px 20px; cursor: pointer; width: 100%;">Add Image</button>
                </div>
            `;
        }
        
        function addMoodboardLinkItem() {
            const title = document.getElementById('link-title').value.trim();
            const url = document.getElementById('link-url').value.trim();
            const notes = document.getElementById('link-notes').value.trim();
            
            if (title && url) {
                const container = document.getElementById('moodboard-container');
                const linkElement = document.createElement('div');
                linkElement.className = 'mood-item';
                linkElement.setAttribute('data-type', 'link');
                linkElement.style.cssText = 'background: var(--bg-primary); padding: 15px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; cursor: pointer;';
                linkElement.setAttribute('onclick', 'showItemDetails(this)');
                linkElement.setAttribute('title', notes || 'No notes provided');
                linkElement.setAttribute('data-url', url);
                
                linkElement.innerHTML = `
                    <div style="flex: 1;">
                        <div style="color: var(--white); font-weight: bold; margin-bottom: 5px;">${title}</div>
                        <div style="color: var(--gray-medium); font-size: 0.9rem;">${notes || 'No notes'}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-small" onclick="event.stopPropagation(); moveItem(this, 'up')" style="font-size: 0.8rem; padding: 4px 8px;">‚Üë</button>
                        <button class="btn-small" onclick="event.stopPropagation(); moveItem(this, 'down')" style="font-size: 0.8rem; padding: 4px 8px;">‚Üì</button>
                        <button class="btn-small" onclick="event.stopPropagation(); removeItem(this)" style="font-size: 0.8rem; padding: 4px 8px;">‚ùå</button>
                    </div>
                `;
                
                container.appendChild(linkElement);
                document.querySelector('div[style*="fixed"]').remove();
            }
        }
        
        function addMoodboardImageItem() {
            const title = document.getElementById('image-title').value.trim();
            const file = document.getElementById('image-file').files[0];
            const notes = document.getElementById('image-notes').value.trim();
            
            if (title && file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const container = document.getElementById('moodboard-container');
                    const imageElement = document.createElement('div');
                    imageElement.className = 'mood-item';
                    imageElement.setAttribute('data-type', 'image');
                    imageElement.style.cssText = 'background: var(--bg-primary); padding: 15px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; cursor: pointer;';
                    imageElement.setAttribute('onclick', 'showItemDetails(this)');
                    imageElement.setAttribute('title', notes || 'No notes provided');
                    
                    imageElement.innerHTML = `
                        <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                            <div style="width: 60px; height: 60px; background-image: url('${e.target.result}'); background-size: cover; background-position: center; border-radius: 4px;"></div>
                            <div>
                                <div style="color: var(--white); font-weight: bold; margin-bottom: 5px;">${title}</div>
                                <div style="color: var(--gray-medium); font-size: 0.9rem;">${notes || 'No notes'}</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-small" onclick="event.stopPropagation(); moveItem(this, 'up')" style="font-size: 0.8rem; padding: 4px 8px;">‚Üë</button>
                            <button class="btn-small" onclick="event.stopPropagation(); moveItem(this, 'down')" style="font-size: 0.8rem; padding: 4px 8px;">‚Üì</button>
                            <button class="btn-small" onclick="event.stopPropagation(); removeItem(this)" style="font-size: 0.8rem; padding: 4px 8px;">‚ùå</button>
                        </div>
                    `;
                    
                    container.appendChild(imageElement);
                    document.querySelector('div[style*="fixed"]').remove();
                };
                reader.readAsDataURL(file);
            }
        }
        
        function moveItem(button, direction) {
            const item = button.closest('.mood-item');
            const container = item.parentElement;
            
            if (direction === 'up' && item.previousElementSibling) {
                container.insertBefore(item, item.previousElementSibling);
            } else if (direction === 'down' && item.nextElementSibling) {
                container.insertBefore(item.nextElementSibling, item);
            }
        }
        
        function removeItem(button) {
            if (confirm('Remove this item from the mood board?')) {
                button.closest('.mood-item').remove();
            }
        }
        
        function showItemDetails(item) {
            const title = item.querySelector('div[style*="font-weight: bold"]').textContent;
            const notes = item.getAttribute('title');
            const type = item.getAttribute('data-type');
            const url = item.getAttribute('data-url');
            
            if (type === 'link' && url) {
                if (confirm(`${title}\n\n${notes}\n\nOpen link in new tab?`)) {
                    window.open(url, '_blank');
                }
            } else {
                alert(`${title}\n\n${notes}`);
            }
        }
        
        function addNewCategory() {
            const categoryName = prompt('Enter new category name:');
            if (categoryName) {
                alert(`Adding new category: ${categoryName}`);
            }
        }
        
        function deleteCategory(category) {
            if (confirm(`Delete the "${category}" category and all its phrases?`)) {
                alert(`Deleting category: ${category}`);
            }
        }
        
        function renameCategory(category) {
            const newName = prompt(`Rename "${category}" to:`, category);
            if (newName && newName !== category) {
                alert(`Renaming "${category}" to "${newName}"`);
            }
        }

        function uploadBulkFiles() {
            const files = document.getElementById('bulk-files').files;
            if (files.length > 0) {
                const formData = new FormData();
                Array.from(files).forEach(file => {
                    formData.append('audio_files', file);
                });
                
                fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`Successfully uploaded ${files.length} files!`);
                        loadBulkFiles();
                        document.getElementById('bulk-files').value = '';
                    } else {
                        alert('Upload failed: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Upload error:', error);
                    alert('Upload failed. Please try again.');
                });
            } else {
                alert('Please select files to upload');
            }
        }

        function upgradeToPhrase(filename) {
            const categories = ['upbeat', 'slow', 'jazzy', 'rock', 'funny', 'sexy', 'serious', 'longing', 'simple', 'emotional'];
            const categoryOptions = categories.map(cat => `<option value="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>`).join('');
            
            const dropdown = `
                <div style="background: var(--bg-secondary); padding: 15px; margin-top: 10px; border: 1px solid var(--border-color);">
                    <label style="color: var(--white); display: block; margin-bottom: 8px;">Select phrase category:</label>
                    <select id="categorySelect-${filename}" style="padding: 8px; width: 150px; background: var(--bg-primary); color: var(--white); border: 1px solid var(--border-color);">
                        <option value="">Choose category...</option>
                        ${categoryOptions}
                    </select>
                    <button onclick="confirmPhraseUpgrade('${filename}')" class="btn-small" style="margin-left: 10px;">Create Phrase</button>
                    <button onclick="cancelUpgrade('${filename}')" class="btn-small" style="margin-left: 5px; background: var(--gray-medium);">Cancel</button>
                </div>
            `;
            
            const fileItem = event.target.closest('.file-item');
            if (!fileItem.querySelector('select')) {
                fileItem.innerHTML += dropdown;
            }
        }

        function upgradeToSong(filename) {
            const songOptions = songsData.map(song => `<option value="${song.id}">${song.title}</option>`).join('');
            
            const dropdown = `
                <div style="background: var(--bg-secondary); padding: 15px; margin-top: 10px; border: 1px solid var(--border-color);">
                    <label style="color: var(--white); display: block; margin-bottom: 8px;">Add to song:</label>
                    <select id="songSelect-${filename}" style="padding: 8px; width: 200px; background: var(--bg-primary); color: var(--white); border: 1px solid var(--border-color);">
                        <option value="">Select existing song...</option>
                        ${songOptions}
                        <option value="new">Create new song</option>
                    </select>
                    <button onclick="confirmSongUpgrade('${filename}')" class="btn-small" style="margin-left: 10px;">Add to Song</button>
                    <button onclick="cancelUpgrade('${filename}')" class="btn-small" style="margin-left: 5px; background: var(--gray-medium);">Cancel</button>
                </div>
            `;
            
            const fileItem = event.target.closest('.file-item');
            if (!fileItem.querySelector('select')) {
                fileItem.innerHTML += dropdown;
            }
        }
        
        function confirmPhraseUpgrade(filename) {
            const categorySelect = document.getElementById(`categorySelect-${filename}`);
            const selectedCategory = categorySelect.value;
            
            if (selectedCategory) {
                alert(`Creating phrase "${filename}" in category "${selectedCategory}"`);
                cancelUpgrade(filename);
            } else {
                alert('Please select a category');
            }
        }
        
        function confirmSongUpgrade(filename) {
            const songSelect = document.getElementById(`songSelect-${filename}`);
            const selectedSong = songSelect.value;
            
            if (selectedSong === 'new') {
                alert(`Creating new song with "${filename}"`);
                cancelUpgrade(filename);
            } else if (selectedSong) {
                const songTitle = songsData.find(s => s.id == selectedSong)?.title || 'Unknown Song';
                alert(`Adding "${filename}" to song "${songTitle}"`);
                cancelUpgrade(filename);
            } else {
                alert('Please select a song');
            }
        }
        
        function cancelUpgrade(filename) {
            const fileItem = document.querySelector(`#categorySelect-${filename}, #songSelect-${filename}`).closest('.file-item');
            const dropdown = fileItem.querySelector('div[style*="background: var(--bg-secondary)"]');
            if (dropdown) {
                dropdown.remove();
            }
        }

        function showCategory(category) {
            const phrasesList = document.getElementById('phrases-list');
            
            // Get category color
            const categoryColors = {
                'upbeat': '#ff6b6b', 'slow': '#4ecdc4', 'jazzy': '#45b7d1', 'rock': '#f39c12',
                'funny': '#f1c40f', 'sexy': '#e74c3c', 'serious': '#34495e', 'longing': '#9b59b6',
                'simple': '#95a5a6', 'emotional': '#e67e22'
            };
            const categoryColor = categoryColors[category] || '#800020';
            
            // Load phrases for the category from backend
            const phrases = [];
            
            phrasesList.innerHTML = `
                <div style="background: #2a2a2a; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: var(--white); margin: 0;">${category.charAt(0).toUpperCase() + category.slice(1)} Phrases</h3>
                </div>
                <div style="display: grid; gap: 15px;">
                    ${phrases.length > 0 ? phrases.map(phrase => `
                        <div class="song-card" style="border-left-color: ${categoryColor};">
                            <div class="song-info">
                                <div class="song-title">"${phrase.title}"</div>
                                <div style="color: var(--gray-medium); font-size: 0.9rem; margin-top: 8px;">
                                    <textarea placeholder="Notes about this phrase..." style="width: 100%; height: 60px; padding: 8px; background: var(--bg-primary); border: 1px solid var(--border-color); color: var(--white); font-size: 0.8rem; resize: none;">${phrase.notes || ''}</textarea>
                                </div>
                            </div>
                            <div class="song-controls">
                                <button class="play-btn" onclick="playPhrase(${phrase.id})" title="Play phrase">‚ñ∂</button>
                                <button class="btn-small" onclick="upgradePhrase(${phrase.id})" style="margin-left: 15px;">‚Üí Song</button>
                            </div>
                        </div>
                    `).join('') : '<div style="text-align: center; color: var(--gray-medium); padding: 40px;">No phrases in this category yet. Click "+ New Phrase" to add one!</div>'}
                </div>
                <button class="add-btn" onclick="goBackToPhrases()" style="margin-top: 20px;">‚Üê Back to Categories</button>
            `;
        }
        
        function goBackToPhrases() {
            document.getElementById('phrases-list').innerHTML = '';
        }
        
        function playPhrase(id) {
            alert(`Playing phrase ${id}`);
        }
        
        function upgradePhrase(id) {
            if (confirm('Upgrade this phrase to a song? You can select which song to add it to.')) {
                // Show song selection dropdown
                const songOptions = songsData.map(song => `<option value="${song.id}">${song.title}</option>`).join('');
                const dropdown = `
                    <select id="songSelect" style="padding: 8px; margin: 10px;">
                        <option value="">Select existing song...</option>
                        ${songOptions}
                        <option value="new">Create new song</option>
                    </select>
                    <button onclick="confirmUpgrade(${id})" class="btn-small">Confirm</button>
                `;
                
                const phraseCard = event.target.closest('.song-card');
                phraseCard.innerHTML += `<div style="margin-top: 10px;">${dropdown}</div>`;
            }
        }
        
        function confirmUpgrade(phraseId) {
            const songSelect = document.getElementById('songSelect');
            const selectedSong = songSelect.value;
            
            if (selectedSong === 'new') {
                alert(`Creating new song with phrase ${phraseId}`);
            } else if (selectedSong) {
                alert(`Adding phrase ${phraseId} to song "${songsData.find(s => s.id == selectedSong)?.title || 'Unknown Song'}"`);
            } else {
                alert('Please select a song');
            }
        }

        // Initialize - Load inbox by default
        document.addEventListener('DOMContentLoaded', function() {
            loadInbox();
            loadSettings();
        });
    </script>

    <!-- Load external JavaScript -->
    <script src="/static/js/main.js"></script>
</body>
</html>